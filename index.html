<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Magical Snow Globe AR</title>
    <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à—ñ –≤–µ—Ä—Å—ñ—ó -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            font-family: Arial, sans-serif;
            background: #000;
        }
        .container { 
            width: 100%; 
            height: 100vh; 
            position: relative; 
        }
        #ar-container { 
            width: 100%; 
            height: 100%; 
        }
        .loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 1000; 
            color: white; 
            background: rgba(0,0,0,0.9); 
            padding: 30px; 
            border-radius: 15px;
            text-align: center;
            border: 2px solid #4a90e2;
            min-width: 280px;
        }
        .loading h3 {
            margin: 0 0 15px 0;
            color: #4a90e2;
        }
        .loading p {
            margin: 8px 0;
            font-size: 16px;
        }
        .loading .small {
            font-size: 14px;
            color: #ccc;
        }
        .error { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            right: 10px;
            z-index: 1001; 
            color: red; 
            background: rgba(255,255,255,0.95); 
            padding: 15px; 
            border-radius: 8px;
            display: none;
            border: 1px solid red;
        }
        .music-control {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1002;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            border: 2px solid #4a90e2;
        }
        .music-control:hover {
            background: rgba(74, 144, 226, 0.3);
        }
        .music-control.playing {
            background: rgba(74, 144, 226, 0.5);
        }
    </style>
</head>
<body>
    <div class="error" id="error"></div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º—É–∑–∏–∫–æ—é -->
    <button class="music-control" id="musicButton">
        üîá –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É
    </button>

    <div class="loading" id="loading">
        <h3>üîÆ –ú–∞–≥—ñ—á–Ω–∞ –∫—É–ª—è</h3>
        <p><strong>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ...</strong></p>
        <p>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä</p>
        <p class="small">–î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏</p>
        <p class="small">–¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥</p>
    </div>
    
    <div class="container">
        <div id="ar-container">
            <a-scene 
                embedded
                mindar-image="imageTargetSrc: ./card.mind; autoStart: true; maxTrack: 1;"
                color-space="sRGB"
                renderer="colorManagement: true;"
                vr-mode-ui="enabled: false"
                device-orientation-permission-ui="enabled: false">
                
                <!-- –ê—É–¥—ñ–æ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ—ó –º—É–∑–∏–∫–∏ -->
                <a-assets>
                    <audio id="backgroundMusic" src="./fon1.mp3" preload="auto"></audio>
                </a-assets>

                <a-camera position="0 0 0" look-controls="enabled: false" active="true"></a-camera>

                <!-- –§–æ–Ω–æ–≤–µ –∞—É–¥—ñ–æ -->
                <a-entity sound="src: #backgroundMusic; autoplay: false; loop: true; volume: 0.5" 
                         id="background-audio"></a-entity>

                <!-- –ì—Ä—É–ø–∞ AR –æ–±'—î–∫—Ç—ñ–≤ -->
                <a-entity mindar-image-target="targetIndex: 0">
                    <!-- –û—Å–Ω–æ–≤–∞ –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ -->
                    <a-sphere 
                        id="magic-sphere"
                        radius="0.4"
                        position="0 0.5 0"
                        color="#aaddff"
                        opacity="0.4"
                        transparent="true"
                        shader="flat"
                        mindar-raycastable>
                    </a-sphere>

                    <!-- –°–Ω—ñ–≥–æ–≤—ñ —á–∞—Å—Ç–∏–Ω–∫–∏ -->
                    <a-entity id="snow-system" position="0 0.5 0">
                        <!-- –°–Ω—ñ–∂–∏–Ω–∫–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
                    </a-entity>

                    <!-- –ü—ñ–¥—Å—Ç–∞–≤–∫–∞ -->
                    <a-cylinder 
                        id="base"
                        radius="0.45"
                        height="0.05"
                        position="0 -0.1 0"
                        color="#888888"
                        opacity="0.8">
                    </a-cylinder>

                    <!-- –¢–µ–∫—Å—Ç (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ñ–≤) -->
                    <a-text 
                        id="magic-text"
                        value="–¢–æ—Ä–∫–Ω–∏—Å—è –∫—É–ª—ñ!"
                        position="0 1.0 0"
                        align="center"
                        color="#ffffff"
                        width="2.5"
                        look-at="[camera]">
                    </a-text>
                </a-entity>
            </a-scene>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞');
            
            var loading = document.getElementById('loading');
            var error = document.getElementById('error');
            var musicButton = document.getElementById('musicButton');
            var scene = document.querySelector('a-scene');
            
            if (!scene) {
                showError('AR —Å—Ü–µ–Ω–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
                return;
            }

            // –°—Ç–∞–Ω –º—É–∑–∏–∫–∏
            var isMusicPlaying = false;
            var audioEntity;

            // –¢–µ–∫—Å—Ç–∏ –¥–ª—è –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ (–±–µ–∑ –µ–º–æ–¥–∑—ñ –≤ –ø–æ—á–∞—Ç–∫—É)
            var texts = [
                "–ë–∞–∂–∞—é —É–¥–∞—á—ñ!",
                "–¢–≤–æ—è –º—Ä—ñ—è –∑–±—É–¥–µ—Ç—å—Å—è",
                "–ú–∞–≥—ñ—è –ø–æ—Ä—É—á",
                "–°—è–π —è—Å–∫—Ä–∞–≤—ñ—à–µ",
                "–ú—Ä—ñ–π —Å–º—ñ–ª–∏–≤—ñ—à–µ",
                "–•–æ–ª–æ–¥–Ω–∞ –ø—Ä–∞–≤–¥–∞",
                "–ì–∞—Ä—è—á–µ –±–∞–∂–∞–Ω–Ω—è",
                "–ß–∏—Å—Ç—ñ –¥—É–º–∫–∏",
                "–ó–º—ñ–Ω–Ω–∏–π –≤—ñ—Ç–µ—Ä",
                "–¢–∞—î–º–Ω–∏—á–∞ –Ω—ñ—á",
                "–Ø—Å–Ω–∏–π –¥–µ–Ω—å",
                "–®–≤–∏–¥–∫–∞ –¥—ñ—è",
                "–ß–∞—Ä—ñ–≤–Ω–∞ —Å–∏–ª–∞",
                "–í—ñ—â—É–π –º–∞–π–±—É—Ç–Ω—î",
                "–°–≤—è—Ç–∫–æ–≤–∏–π –Ω–∞—Å—Ç—Ä—ñ–π"
            ];

            var currentTextIndex = 0;
            var isRotating = false;
            var snowflakes = [];

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º—É–∑–∏–∫–æ—é
            function setupMusicControl() {
                musicButton.addEventListener('click', function() {
                    if (!audioEntity) {
                        audioEntity = document.querySelector('#background-audio');
                    }
                    
                    if (audioEntity) {
                        if (isMusicPlaying) {
                            // –í–∏–º–∏–∫–∞—î–º–æ –º—É–∑–∏–∫—É
                            audioEntity.components.sound.stopSound();
                            musicButton.textContent = 'üîá –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É';
                            musicButton.classList.remove('playing');
                        } else {
                            // –í–º–∏–∫–∞—î–º–æ –º—É–∑–∏–∫—É
                            audioEntity.components.sound.playSound();
                            musicButton.textContent = 'üîä –í–∏–º–∏–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É';
                            musicButton.classList.add('playing');
                        }
                        isMusicPlaying = !isMusicPlaying;
                    } else {
                        showError('–ê—É–¥—ñ–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                    }
                });
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
            function createSnowflakes() {
                var snowSystem = document.getElementById('snow-system');
                if (!snowSystem) {
                    console.log('–°–∏—Å—Ç–µ–º–∞ —Å–Ω—ñ–≥—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ 40 —Å–Ω—ñ–∂–∏–Ω–æ–∫
                for (var i = 0; i < 40; i++) {
                    var snowflake = document.createElement('a-sphere');
                    var size = 0.008 + Math.random() * 0.015;
                    
                    // –í–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫—É–ª—ñ
                    var x = (Math.random() - 0.5) * 0.7;
                    var y = (Math.random() - 0.5) * 0.7;
                    var z = (Math.random() - 0.5) * 0.7;
                    
                    snowflake.setAttribute('radius', size);
                    snowflake.setAttribute('color', 'white');
                    snowflake.setAttribute('opacity', '0.7');
                    snowflake.setAttribute('position', x + ' ' + y + ' ' + z);
                    snowflake.setAttribute('class', 'snowflake');
                    
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    snowflake.dataset.speed = (0.1 + Math.random() * 0.2).toString();
                    snowflake.dataset.angle = (Math.random() * Math.PI * 2).toString();
                    snowflake.dataset.originalY = y.toString();
                    
                    snowSystem.appendChild(snowflake);
                    snowflakes.push(snowflake);
                }
                console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ ' + snowflakes.length + ' —Å–Ω—ñ–∂–∏–Ω–æ–∫');
            }

            // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
            function animateSnow() {
                var time = Date.now() * 0.001;
                
                for (var i = 0; i < snowflakes.length; i++) {
                    var snowflake = snowflakes[i];
                    var speed = parseFloat(snowflake.dataset.speed);
                    var angle = parseFloat(snowflake.dataset.angle);
                    var originalY = parseFloat(snowflake.dataset.originalY);
                    
                    var pos = snowflake.getAttribute('position');
                    var newY = pos.y - 0.008 * speed;
                    
                    // –Ø–∫—â–æ —Å–Ω—ñ–∂–∏–Ω–∫–∞ –≤–ø–∞–ª–∞ –∑–∞–Ω–∞–¥—Ç–æ –Ω–∏–∑—å–∫–æ - –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ —ó—ó –≤–≥–æ—Ä—É
                    if (newY < -0.35) {
                        newY = 0.35;
                        snowflake.dataset.originalY = newY.toString();
                    }
                    
                    // –õ–µ–≥–∫–µ –∫–æ–ª–∏–≤–∞–Ω–Ω—è
                    var swingX = Math.sin(time * speed + angle) * 0.01;
                    var swingZ = Math.cos(time * speed * 0.8 + angle) * 0.01;
                    
                    var newX = pos.x + swingX;
                    var newZ = pos.z + swingZ;
                    
                    snowflake.setAttribute('position', newX + ' ' + newY + ' ' + newZ);
                    
                    // –û–±–µ—Ä—Ç–∞–Ω–Ω—è —Å–Ω—ñ–∂–∏–Ω–∫–∏
                    snowflake.setAttribute('rotation', 
                        (time * 20 * speed) + ' ' + 
                        (time * 30 * speed) + ' ' + 
                        (time * 25 * speed)
                    );
                    
                    // –ú–µ—Ä–µ—Ö—Ç—ñ–Ω–Ω—è
                    var flicker = 0.5 + Math.sin(time * 3 + angle) * 0.3;
                    snowflake.setAttribute('opacity', (0.5 * flicker).toString());
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –∫—É—Ç –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó
                    snowflake.dataset.angle = (angle + 0.01).toString();
                }
            }

            // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –ø–æ –∫—É–ª—ñ
            function setupClickHandler() {
                var sphere = document.getElementById('magic-sphere');
                if (!sphere) {
                    console.log('–°—Ñ–µ—Ä–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞, —Å–ø—Ä–æ–±—É—î–º–æ –∑–Ω–æ–≤—É...');
                    setTimeout(setupClickHandler, 500);
                    return;
                }

                sphere.addEventListener('click', function() {
                    if (isRotating) return;
                    
                    isRotating = true;
                    var textElement = document.getElementById('magic-text');
                    
                    if (!textElement) {
                        isRotating = false;
                        return;
                    }
                    
                    console.log('–ö—É–ª—è –∫–ª—ñ–∫–Ω—É—Ç–∞, –æ–±–µ—Ä—Ç–∞—î–º–æ —Ç–µ–∫—Å—Ç');
                    
                    // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
                    textElement.setAttribute('animation', {
                        property: 'rotation',
                        to: '0 360 0',
                        dur: 800,
                        easing: 'easeOutCubic'
                    });

                    // –ó–º—ñ–Ω–∞ —Ç–µ–∫—Å—Ç—É –ø—ñ—Å–ª—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                    setTimeout(function() {
                        currentTextIndex = (currentTextIndex + 1) % texts.length;
                        textElement.setAttribute('value', texts[currentTextIndex]);
                        isRotating = false;
                        console.log('–¢–µ–∫—Å—Ç –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ' + texts[currentTextIndex]);
                    }, 800);
                });
                
                console.log('–û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
            }

            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É
            function showError(message) {
                if (error) {
                    error.textContent = '‚ùå ' + message;
                    error.style.display = 'block';
                }
                console.error(message);
            }

            // –ö–æ–ª–∏ —Å—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
            scene.addEventListener('loaded', function() {
                console.log('AR —Å—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ');
                
                // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º—É–∑–∏–∫–æ—é
                setupMusicControl();
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Å–Ω—ñ–∂–∏–Ω–∫–∏
                createSnowflakes();
                
                // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É
                setTimeout(setupClickHandler, 1500);
                
                // –ù–ï —Ö–æ–≤–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è - –∑–∞–ª–∏—à–∞—î–º–æ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
                console.log('–ï–∫—Ä–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤–∏–¥–∏–º–∏–º');
                
                // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–Ω—ñ–≥—É
                setInterval(animateSnow, 50);
                console.log('–ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–≥—É –∑–∞–ø—É—â–µ–Ω–∞');
            });

            // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            scene.addEventListener('error', function(e) {
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR: ' + JSON.stringify(e.detail));
            });

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–∞–º–µ—Ä–∏
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showError('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫–∞–º–µ—Ä—É. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Chrome, Safari –∞–±–æ Firefox.');
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ HTTPS
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                showError('–î–ª—è —Ä–æ–±–æ—Ç–∏ AR –ø–æ—Ç—Ä—ñ–±–µ–Ω HTTPS. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ GitHub Pages –∞–±–æ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä.');
            }
        });
    </script>
</body>
</html>
