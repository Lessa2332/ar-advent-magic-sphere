<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Magical Snow Globe AR</title>
    <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à—ñ –≤–µ—Ä—Å—ñ—ó –±–µ–∑ ES6 –º–æ–¥—É–ª—ñ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: Arial, sans-serif; }
        .container { width: 100%; height: 100vh; position: relative; }
        #ar-container { width: 100%; height: 100%; }
        .loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 1000; 
            color: white; 
            background: rgba(0,0,0,0.8); 
            padding: 20px; 
            border-radius: 10px;
            text-align: center;
        }
        .error { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            right: 10px;
            z-index: 1001; 
            color: red; 
            background: rgba(255,255,255,0.9); 
            padding: 10px; 
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="error" id="error"></div>
    <div class="loading" id="loading">
        <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ...</div>
        <div style="font-size: 14px; margin-top: 10px;">–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä</div>
        <div style="font-size: 12px; margin-top: 5px;">–î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏</div>
    </div>
    
    <div class="container">
        <div id="ar-container">
            <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç—ñ—à–∏–π –ø—ñ–¥—Ö—ñ–¥ -->
            <a-scene 
                embedded
                mindar-image="imageTargetSrc: ./card.mind; autoStart: true; maxTrack: 1;"
                color-space="sRGB"
                renderer="colorManagement: true;"
                vr-mode-ui="enabled: false"
                device-orientation-permission-ui="enabled: false">
                
                <a-assets>
                    <!-- –î–æ–¥–∞—î–º–æ –Ω–µ–≤–µ–ª–∏–∫—É –∑–∞—Ç—Ä–∏–º–∫—É –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
                </a-assets>

                <a-camera position="0 0 0" look-controls="enabled: false" active="true"></a-camera>

                <!-- –ì—Ä—É–ø–∞ AR –æ–±'—î–∫—Ç—ñ–≤ -->
                <a-entity mindar-image-target="targetIndex: 0">
                    <!-- –û—Å–Ω–æ–≤–∞ –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ -->
                    <a-sphere 
                        id="magic-sphere"
                        radius="0.4"
                        position="0 0.5 0"
                        color="#aaddff"
                        opacity="0.4"
                        transparent="true"
                        shader="flat">
                    </a-sphere>

                    <!-- –°–Ω—ñ–≥–æ–≤—ñ —á–∞—Å—Ç–∏–Ω–∫–∏ -->
                    <a-entity id="snow-system" position="0 0.5 0">
                        <!-- –°–Ω—ñ–∂–∏–Ω–∫–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
                    </a-entity>

                    <!-- –ü—ñ–¥—Å—Ç–∞–≤–∫–∞ -->
                    <a-cylinder 
                        id="base"
                        radius="0.45"
                        height="0.05"
                        position="0 -0.1 0"
                        color="#888888"
                        opacity="0.8">
                    </a-cylinder>

                    <!-- –¢–µ–∫—Å—Ç -->
                    <a-text 
                        id="magic-text"
                        value="–û–±–µ—Ä–Ω–∏ –º–µ–Ω–µ!"
                        position="0 1.0 0"
                        align="center"
                        color="#ffffff"
                        width="2"
                        look-at="[camera]">
                    </a-text>
                </a-entity>
            </a-scene>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–µ–∑ —Å–∫–ª–∞–¥–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            
            var loading = document.getElementById('loading');
            var error = document.getElementById('error');
            var scene = document.querySelector('a-scene');
            
            if (!scene) {
                showError('AR —Å—Ü–µ–Ω–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
                return;
            }

            // –¢–µ–∫—Å—Ç–∏ –¥–ª—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
            var texts = [
                "‚ú® –ë–∞–∂–∞—é —É–¥–∞—á—ñ!",
                "üéØ –¢–≤–æ—è –º—Ä—ñ—è –∑–±—É–¥–µ—Ç—å—Å—è",
                "üîÆ –ú–∞–≥—ñ—è –ø–æ—Ä—É—á",
                "üåü –°—è–π —è—Å–∫—Ä–∞–≤—ñ—à–µ",
                "üí´ –ú—Ä—ñ–π —Å–º—ñ–ª–∏–≤—ñ—à–µ",
                "‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–∞ –ø—Ä–∞–≤–¥–∞",
                "üî• –ì–∞—Ä—è—á–µ –±–∞–∂–∞–Ω–Ω—è",
                "üíß –ß–∏—Å—Ç—ñ –¥—É–º–∫–∏",
                "üå™Ô∏è –ó–º—ñ–Ω–Ω–∏–π –≤—ñ—Ç–µ—Ä",
                "üåô –¢–∞—î–º–Ω–∏—á–∞ –Ω—ñ—á",
                "‚òÄÔ∏è –Ø—Å–Ω–∏–π –¥–µ–Ω—å",
                "‚ö° –®–≤–∏–¥–∫–∞ –¥—ñ—è",
                "ü™Ñ –ß–∞—Ä—ñ–≤–Ω–∞ —Å–∏–ª–∞",
                "üîÆ –í—ñ—â—É–π –º–∞–π–±—É—Ç–Ω—î",
                "üéÑ –°–≤—è—Ç–∫–æ–≤–∏–π –Ω–∞—Å—Ç—Ä—ñ–π"
            ];

            var currentTextIndex = 0;
            var isRotating = false;
            var snowflakes = [];

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
            function createSnowflakes() {
                var snowSystem = document.getElementById('snow-system');
                if (!snowSystem) return;
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ 30 —Å–Ω—ñ–∂–∏–Ω–æ–∫
                for (var i = 0; i < 30; i++) {
                    var snowflake = document.createElement('a-sphere');
                    var size = 0.01 + Math.random() * 0.02;
                    var x = (Math.random() - 0.5) * 0.7;
                    var y = (Math.random() - 0.5) * 0.7;
                    var z = (Math.random() - 0.5) * 0.7;
                    
                    snowflake.setAttribute('radius', size);
                    snowflake.setAttribute('color', 'white');
                    snowflake.setAttribute('opacity', '0.6');
                    snowflake.setAttribute('position', x + ' ' + y + ' ' + z);
                    snowflake.setAttribute('class', 'snowflake');
                    
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    snowflake.dataset.speed = (0.2 + Math.random() * 0.3).toString();
                    snowflake.dataset.angle = (Math.random() * Math.PI * 2).toString();
                    
                    snowSystem.appendChild(snowflake);
                    snowflakes.push(snowflake);
                }
            }

            // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
            function animateSnow() {
                var time = Date.now() * 0.001;
                
                for (var i = 0; i < snowflakes.length; i++) {
                    var snowflake = snowflakes[i];
                    var speed = parseFloat(snowflake.dataset.speed);
                    var angle = parseFloat(snowflake.dataset.angle);
                    
                    var pos = snowflake.getAttribute('position');
                    var newY = pos.y - 0.01 * speed;
                    
                    // –Ø–∫—â–æ —Å–Ω—ñ–∂–∏–Ω–∫–∞ –≤–ø–∞–ª–∞ –∑–∞–Ω–∞–¥—Ç–æ –Ω–∏–∑—å–∫–æ - –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ —ó—ó –≤–≥–æ—Ä—É
                    if (newY < -0.4) {
                        newY = 0.4;
                    }
                    
                    // –õ–µ–≥–∫–µ –∫–æ–ª–∏–≤–∞–Ω–Ω—è
                    var swing = Math.sin(time * speed + angle) * 0.02;
                    var newX = pos.x + swing;
                    var newZ = pos.z + swing;
                    
                    snowflake.setAttribute('position', newX + ' ' + newY + ' ' + newZ);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –∫—É—Ç –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó
                    snowflake.dataset.angle = (angle + 0.02).toString();
                }
            }

            // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –ø–æ –∫—É–ª—ñ
            function setupClickHandler() {
                var sphere = document.getElementById('magic-sphere');
                if (!sphere) {
                    console.log('–°—Ñ–µ—Ä–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞, —Å–ø—Ä–æ–±—É—î–º–æ –∑–Ω–æ–≤—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É');
                    setTimeout(setupClickHandler, 1000);
                    return;
                }

                sphere.addEventListener('click', function() {
                    if (isRotating) return;
                    
                    isRotating = true;
                    var textElement = document.getElementById('magic-text');
                    
                    if (!textElement) return;
                    
                    // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
                    textElement.setAttribute('animation', {
                        property: 'rotation',
                        to: '0 360 0',
                        dur: 800,
                        easing: 'easeOutCubic'
                    });

                    // –ó–º—ñ–Ω–∞ —Ç–µ–∫—Å—Ç—É –ø—ñ—Å–ª—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                    setTimeout(function() {
                        currentTextIndex = (currentTextIndex + 1) % texts.length;
                        textElement.setAttribute('value', texts[currentTextIndex]);
                        isRotating = false;
                    }, 800);
                });
                
                console.log('–û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }

            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É
            function showError(message) {
                if (error) {
                    error.textContent = message;
                    error.style.display = 'block';
                }
                console.error(message);
            }

            // –ö–æ–ª–∏ —Å—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
            scene.addEventListener('loaded', function() {
                console.log('AR —Å—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ');
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Å–Ω—ñ–∂–∏–Ω–∫–∏
                createSnowflakes();
                
                // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É
                setTimeout(setupClickHandler, 1000);
                
                // –•–æ–≤–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                setTimeout(function() {
                    if (loading) loading.style.display = 'none';
                }, 2000);
                
                // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Å–Ω—ñ–≥—É
                setInterval(animateSnow, 50);
            });

            // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            scene.addEventListener('error', function(e) {
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR: ' + e.detail);
            });

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showError('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫–∞–º–µ—Ä—É. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Chrome –∞–±–æ Safari.');
            }
        });
    </script>
</body>
</html>
