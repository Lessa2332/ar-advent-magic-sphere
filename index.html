<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Передай лист Санті</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/webxr/VRButton.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/webxr/ARButton.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #0a1e3a;
            font-family: sans-serif;
        }
        
        #startScreen, #loading {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #0f3443, #1e5a7e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            z-index: 100;
        }
        
        h1 {
            font-size: 2.8em;
            color: #ffd700;
            text-shadow: 0 0 20px gold;
            margin-bottom: 20px;
        }
        
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.6em;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(231,76,60,.6);
            cursor: pointer;
            transition: .2s;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #hint {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: #000000cc;
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 1.7em;
            z-index: 10;
            pointer-events: none;
            max-width: 90%;
            text-align: center;
            color: white;
        }
        
        #sendBtn {
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: #27ae60;
            padding: 20px 60px;
            font-size: 2em;
            border-radius: 50px;
            z-index: 20;
            display: none;
            cursor: pointer;
            border: none;
            color: white;
        }
        
        .hidden {
            display: none !important;
        }
        
        #hint button {
            pointer-events: auto;
        }
        
        #canvasContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div id="startScreen">
    <h1>Передай лист Санті</h1>
    <p>Напиши бажання на папері — і віддай його ельфу!</p>
    <button id="startBtn">Почати</button>
</div>

<div id="loading" class="hidden">Завантаження...</div>

<div id="hint">Знайди дзвіночок!</div>
<button id="sendBtn">Відправити лист</button>

<div id="canvasContainer"></div>

<script>
    let step = 0;
    let scene, camera, renderer;
    let elf, bell, star;
    let waitingSound, magicSound;
    let animationId = null;

    const hint = document.getElementById('hint');
    const sendBtn = document.getElementById('sendBtn');
    const canvasContainer = document.getElementById('canvasContainer');

    // Імітація AR-маркерів (замість MindAR)
    const markers = {
        bell: { found: false, position: new THREE.Vector3(-2, 0, -3) },
        star: { found: false, position: new THREE.Vector3(2, 0, -3) }
    };

    function init() {
        // Створення сцени
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a1e3a);

        // Камера
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 0);

        // Рендерер
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        canvasContainer.appendChild(renderer.domElement);

        // Додавання кнопки AR
        document.body.appendChild(THREE.ARButton.createButton(renderer));

        // Освітлення
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7);
        scene.add(directionalLight);

        // Створення об'єктів
        createObjects();
        
        // Запуск анімації
        animate();

        // Обробник зміни розміру вікна
        window.addEventListener('resize', onWindowResize);
    }

    function createObjects() {
        // Дзвіночок (маркер 1)
        const bellGeometry = new THREE.SphereGeometry(0.3, 16, 16);
        const bellMaterial = new THREE.MeshPhongMaterial({ 
            color: 0xffd700,
            transparent: true,
            opacity: 0
        });
        bell = new THREE.Mesh(bellGeometry, bellMaterial);
        bell.position.copy(markers.bell.position);
        scene.add(bell);

        // Зірочка (маркер 2)
        const starGeometry = new THREE.ConeGeometry(0.2, 0.4, 4);
        const starMaterial = new THREE.MeshPhongMaterial({ 
            color: 0xffffff,
            transparent: true,
            opacity: 0
        });
        star = new THREE.Mesh(starGeometry, starMaterial);
        star.position.copy(markers.star.position);
        scene.add(star);

        // Ельф (з'являється біля зірочки)
        const elfGeometry = new THREE.ConeGeometry(0.5, 1, 8);
        const elfMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
        elf = new THREE.Mesh(elfGeometry, elfMaterial);
        elf.position.set(3.4, 1.1, -3.8);
        elf.visible = false;
        scene.add(elf);

        // Імітація звуків
        waitingSound = { isPlaying: false, volume: 1 };
        magicSound = { isPlaying: false, volume: 1 };
    }

    function animate() {
        animationId = requestAnimationFrame(animate);

        // Оновлення логіки маркерів
        updateMarkers();

        // Анімація об'єктів
        if (bell) bell.rotation.y += 0.02;
        if (star) star.rotation.y += 0.01;
        if (elf && elf.visible) {
            elf.rotation.y += 0.02;
            elf.position.y = 1.1 + Math.sin(Date.now() * 0.002) * 0.1;
        }

        renderer.render(scene, camera);
    }

    function updateMarkers() {
        // Імітація знаходження маркерів (замість комп'ютерного зору)
        const cameraPosition = camera.position;
        
        // Перевірка близькості до дзвіночка
        if (!markers.bell.found && cameraPosition.distanceTo(markers.bell.position) < 1.5) {
            markers.bell.found = true;
            bell.material.opacity = 1;
            if (step === 0) {
                step = 1;
                hint.textContent = "Чудово! Тепер зірочку!";
            }
        }

        // Перевірка близькості до зірочки
        if (!markers.star.found && cameraPosition.distanceTo(markers.star.position) < 1.5) {
            markers.star.found = true;
            star.material.opacity = 1;
            if (step === 1) {
                step = 2;
                hint.textContent = "Я десь поруч… підійди ближче, почуєш!";
                // Імітація звуку очікування
                waitingSound.isPlaying = true;
            }
        }

        // Перевірка близькості до ельфа
        if (step === 2 && elf) {
            const distanceToElf = cameraPosition.distanceTo(elf.position);
            elf.visible = distanceToElf < 2;
            
            // Оновлення гучності звуку
            if (waitingSound.isPlaying) {
                waitingSound.volume = Math.max(0.1, Math.min(1, 1 - distanceToElf / 4));
            }

            // Показ кнопки при близькій відстані
            sendBtn.style.display = distanceToElf < 1 ? 'block' : 'none';
        }
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function createRestartButton() {
        const btn = document.createElement('button');
        btn.textContent = 'Заново';
        btn.style.cssText = 'margin-top:20px;padding:15px 50px;font-size:1.6em;background:#27ae60;border:none;border-radius:50px;cursor:pointer';
        btn.addEventListener('click', function() {
            location.reload();
        });
        return btn;
    }

    // Обробник кнопки старту
    document.getElementById('startBtn').addEventListener('click', function() {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');
        
        setTimeout(function() {
            document.getElementById('loading').classList.add('hidden');
            init();
        }, 1500);
    });

    // Обробник кнопки відправки
    sendBtn.addEventListener('click', function() {
        step = 3;
        sendBtn.style.display = 'none';
        
        if (elf) elf.visible = false;
        
        // Зупинка звуку очікування
        waitingSound.isPlaying = false;

        // Магічна анімація
        magicSound.isPlaying = true;

        hint.innerHTML = "Я передав твоє бажання Санті!<br>Вітаю з Різдвом!";

        // Додавання кнопки "Заново" після завершення
        setTimeout(function() {
            const restartBtn = createRestartButton();
            hint.appendChild(restartBtn);
        }, 4000);
    });

    // Початкова ініціалізація
    console.log("Додаток 'Передай лист Санті' готовий до запуску");
</script>
</body>
</html>
