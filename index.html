<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ê–¥–≤–µ–Ω—Ç-–ö–∞–ª–µ–Ω–¥–∞—Ä üéÑ</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Caveat', cursive; }
        #info { 
            position: absolute; top: 10px; left: 10px; color: #fff; z-index: 100; 
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; font-size: 18px; 
            text-align: center; max-width: 300px;
        }
        #today { color: #ffd700; font-weight: bold; }
    </style>
</head>
<body>
    <div id="info">
        AR –ê–¥–≤–µ–Ω—Ç-–ö–∞–ª–µ–Ω–¥–∞—Ä üéÑ<br>
        –°—å–æ–≥–æ–¥–Ω—ñ: –î–µ–Ω—å <span id="today">1</span><br>
        –ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä —ñ —Ç–æ—Ä–∫–Ω–∏—Å—è –∫—É–ª—ñ!
    </div>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"></script>
    <script>
        // –í–±—É–¥–æ–≤–∞–Ω–∏–π JS (–∑–∞–º—ñ—Å—Ç—å main.js)
        const adventTasks = [
            "–ó–∞–ø–∞–ª–∏ —Å–≤—ñ—á–∫—É —ñ –∑–∞–≥–∞–¥–∞–π –±–∞–∂–∞–Ω–Ω—è üéÑ",  // –î–µ–Ω—å 1
            "–ù–∞–ø–∏—à–∏ –ª–∏—Å—Ç–∞ –°–∞–Ω—Ç—ñ üìù",               // –î–µ–Ω—å 2
            "–ó—Ä–æ–±–∏ —Ñ–æ—Ç–æ –∑ —è–ª–∏–Ω–∫–æ—é üì∏",             // –î–µ–Ω—å 3
            "–°–ø—ñ–≤–∞–π —Ä—ñ–∑–¥–≤—è–Ω—É –ø—ñ—Å–Ω—é 30 —Å–µ–∫ üéµ",     // –î–µ–Ω—å 4
            "–ü–æ–¥—ñ–ª–∏—Å—è —Ç–µ–ø–ª–æ–º: –æ–±—ñ–π–º–∏ –∫–æ–≥–æ—Å—å ü§ó",   // –î–µ–Ω—å 5
            "–ü–æ–¥–∞—Ä—É–π –∫–æ–º–ø–ª—ñ–º–µ–Ω—Ç –Ω–µ–∑–Ω–∞–π–æ–º—Ü—é üí¨",   // –î–µ–Ω—å 6
            "–ù–∞–∫–ª–µ–π –Ω–∞–ª—ñ–ø–∫—É –∑ –ø–æ—Å–º–æ–º –Ω–∞ –¥–∑–µ—Ä–∫–∞–ª–æ üéÄ", // –î–µ–Ω—å 7
            "–ó—Ä–æ–±–∏ –≥–æ–¥—ñ–≤–Ω–∏—á–∫—É –¥–ª—è –ø—Ç–∞—Ö—ñ–≤ üê¶",      // –î–µ–Ω—å 8
            "–î–æ–ø–æ–º–æ–∂–∏ —Å—É—Å—ñ–¥—É –∑ –ø–æ–∫—É–ø–∫–∞–º–∏ üõí",       // –î–µ–Ω—å 9
            "–ó–∞–ª–∏—à –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –ø–æ–¥–∞—Ä—É–Ω–æ–∫ –Ω–∞ —Å—Ç–æ–ª—ñ üéÅ", // –î–µ–Ω—å 10
            "–ù–∞–º–∞–ª—é–π —Å–Ω—ñ–≥–æ–≤–∏–∫–∞ –Ω–∞ –≤—ñ–∫–Ω—ñ ‚ùÑÔ∏è",       // –î–µ–Ω—å 11
            "–°–∫–ª–∞–¥–∏ –≤—ñ—Ä—à –ø—Ä–æ –∑–∏–º—É üìñ",             // –î–µ–Ω—å 12
            "–ó—Ä–æ–±–∏ —è–ª–∏–Ω–∫–æ–≤—É –ø—Ä–∏–∫—Ä–∞—Å—É –∑ –ø–∞–ø–µ—Ä—É ‚úÇÔ∏è", // –î–µ–Ω—å 13
            "–ü—Ä–∏–¥—É–º–∞–π –Ω–æ–≤—É —Ä—ñ–∑–¥–≤—è–Ω—É —Ç—Ä–∞–¥–∏—Ü—ñ—é üåü",  // –î–µ–Ω—å 14
            "–ó–Ω—ñ–º–∏ AR-–≤—ñ–¥–µ–æ –∑ –∫—É–ª–µ—é —ñ –ø–æ–¥—ñ–ª–∏—Å—è üé•", // –î–µ–Ω—å 15
            "–¢–∞–Ω—Ü—é–π –ø—ñ–¥ 'Jingle Bells' üíÉ",        // –î–µ–Ω—å 16
            "–†–æ–∑–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç –ø—Ä–æ –†—ñ–∑–¥–≤–æ üòÇ",       // –î–µ–Ω—å 17
            "–ó—Ä–æ–±–∏ —Å–µ–ª—Ñ—ñ –∑ '—Ä—ñ–∑–¥–≤—è–Ω–∏–º' —Ñ—ñ–ª—å—Ç—Ä–æ–º üòé", // –î–µ–Ω—å 18
            "–ó–Ω–∞–π–¥–∏ 5 –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —á–µ—Ä–≤–æ–Ω–æ–≥–æ –∫–æ–ª—å–æ—Ä—É ‚ù§Ô∏è", // –î–µ–Ω—å 19
            "–í–ª–∞—à—Ç—É–π –º—ñ–Ω—ñ-–¥–∏—Å–∫–æ –≤–¥–æ–º–∞ üï∫",         // –î–µ–Ω—å 20
            "–ù–∞–ø–∏—à–∏ 3 —Ä–µ—á—ñ, –∑–∞ —è–∫—ñ —Ç–∏ –≤–¥—è—á–Ω–∏–π üôè", // –î–µ–Ω—å 21
            "–ü—Ä–∏–≥–æ—Ç—É–π –≥–ª—ñ–Ω—Ç–≤–µ–π–Ω –∞–±–æ –∫–∞–∫–∞–æ ‚òï",     // –î–µ–Ω—å 22
            "–ü–æ–¥–∏–≤–∏—Å—å —Ä—ñ–∑–¥–≤—è–Ω–∏–π —Ñ—ñ–ª—å–º üé¨",         // –î–µ–Ω—å 23
            "–ü–æ–∫–ª–∞–¥–∏ –ø–æ–¥–∞—Ä—É–Ω–∫–∏ –ø—ñ–¥ —è–ª–∏–Ω–∫—É üéÑ",     // –î–µ–Ω—å 24
            "–ó –†—ñ–∑–¥–≤–æ–º! –í—ñ–¥–∫—Ä–∏–π –∫—É–ª—é ‚Äî —Ç–∏ –∑–∞—Å–ª—É–∂–∏–≤! üéâ" // –î–µ–Ω—å 25
        ];

        document.addEventListener('DOMContentLoaded', async () => {
            const start = async () => {
                // –õ–æ–≥—ñ–∫–∞ –¥–∞—Ç–∏
                const today = new Date();
                const currentDay = today.getDate();
                const currentMonth = today.getMonth() + 1;
                const adventMonth = 12;
                const totalDays = 25;
                const unlockedDays = (currentMonth === adventMonth && currentDay <= totalDays) 
                    ? currentDay 
                    : (currentMonth > adventMonth ? totalDays : 0);
                document.getElementById('today').innerText = unlockedDays || '0 (—á–µ–∫–∞–π –≥—Ä—É–¥–Ω—è!)';

                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MindAR
                const mindarThree = new window.MINDAR.IMAGE.MindARThree({
                    container: document.body,
                    imageTargetSrc: './card.mind'  // –ó–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤—ñ–π .mind —Ñ–∞–π–ª
                });
                const { renderer, scene, camera } = mindarThree;

                // –°–∫–ª—è–Ω–∞ —Å—Ñ–µ—Ä–∞
                const sphereGeometry = new THREE.SphereGeometry(0.1, 32, 32);
                const sphereMaterial = new THREE.MeshPhysicalMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.3,
                    metalness: 0.9,
                    roughness: 0.1,
                    transmission: 0.9,
                    thickness: 0.1
                });
                const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
                sphere.position.set(0, 0, 0.01);

                // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç—ñ–≤
                const textContainer = new THREE.Group();
                textContainer.position.set(0, 0, 0);
                const texts = [];
                const numDays = 25;
                const radius = 0.18;

                // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä–∏ –∑ Canvas
                function createTextTexture(day, task, isUnlocked) {
                    const canvas = document.createElement('canvas');
                    canvas.width = 512;
                    canvas.height = 256;
                    const ctx = canvas.getContext('2d');

                    // –ì—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ñ–æ–Ω
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, isUnlocked ? '#4a90e2' : '#666666');
                    gradient.addColorStop(1, isUnlocked ? '#9013fe' : '#333333');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // –†–∞–º–∫–∞
                    ctx.strokeStyle = isUnlocked ? '#ffd700' : '#888';
                    ctx.lineWidth = 4;
                    ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

                    // –¢–µ–∫—Å—Ç: –î–µ–Ω—å
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 48px "Playfair Display"';
                    ctx.textAlign = 'center';
                    ctx.fillText(`–î–µ–Ω—å ${day}`, canvas.width / 2, 80);

                    // –ó–∞–≤–¥–∞–Ω–Ω—è (–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–º)
                    ctx.font = '32px "Caveat"';
                    ctx.fillStyle = isUnlocked ? 'white' : '#ccc';
                    const lines = wrapText(ctx, task, canvas.width - 40, 32);
                    lines.forEach((line, i) => {
                        ctx.fillText(line, canvas.width / 2, 140 + i * 40);
                    });

                    // –Ü–∫–æ–Ω–∫–∞
                    ctx.font = 'bold 60px Arial';
                    ctx.fillText(isUnlocked ? 'üéÑ' : 'üîí', canvas.width / 2, 220);

                    return new THREE.CanvasTexture(canvas);
                }

                // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–Ω–æ—Å—É —Ç–µ–∫—Å—Ç—É
                function wrapText(ctx, text, maxWidth, lineHeight) {
                    const words = text.split(' ');
                    const lines = [];
                    let currentLine = '';
                    words.forEach(word => {
                        const testLine = currentLine + word + ' ';
                        if (ctx.measureText(testLine).width > maxWidth) {
                            lines.push(currentLine.trim());
                            currentLine = word + ' ';
                        } else {
                            currentLine = testLine;
                        }
                    });
                    lines.push(currentLine.trim());
                    return lines;
                }

                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–æ—â–∏–Ω –∑ —Ç–µ–∫—Å—Ç–∞–º–∏
                for (let i = 0; i < numDays; i++) {
                    const day = i + 1;
                    const task = adventTasks[day - 1];
                    const planeGeometry = new THREE.PlaneGeometry(0.08, 0.05);

                    const material = new THREE.MeshBasicMaterial({
                        map: createTextTexture(day, task, day <= unlockedDays),
                        transparent: true,
                        side: THREE.DoubleSide
                    });

                    const plane = new THREE.Mesh(planeGeometry, material);
                    const angle = (i / numDays) * Math.PI * 2;
                    plane.position.set(
                        Math.cos(angle) * radius,
                        Math.sin(angle) * radius * 0.5,
                        Math.sin(angle) * radius
                    );
                    plane.lookAt(0, 0, 0);
                    plane.userData = { day, unlocked: day <= unlockedDays };

                    textContainer.add(plane);
                    texts.push(plane);
                }

                // –Ø–∫—ñ—Ä –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
                const anchor = mindarThree.addAnchor(0);
                anchor.group.add(sphere);
                anchor.group.add(textContainer);

                // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                let isRotating = false;
                let rotationSpeed = 0.01;
                let hasOpenedToday = false;

                // Raycaster –¥–ª—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ü—ñ—ó
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();

                // –û–±—Ä–æ–±–Ω–∏–∫ —Ç–æ—Ä–∫–∞–Ω–Ω—è
                window.addEventListener('click', (event) => {
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(texts);

                    if (intersects.length > 0) {
                        const clicked = intersects[0].object;
                        const day = clicked.userData.day;

                        if (!clicked.userData.unlocked) {
                            showMessage(`–î–µ–Ω—å ${day} —â–µ –Ω–µ –Ω–∞—Å—Ç–∞–≤! üîí`);
                            return;
                        }

                        if (day === currentDay && !hasOpenedToday) {
                            openDay(clicked, day);
                            hasOpenedToday = true;
                        } else if (day < currentDay) {
                            showMessage(`–î–µ–Ω—å ${day} –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–æ! üéÑ`);
                        }
                    } else {
                        // –¢–æ—Ä–∫–∞–Ω–Ω—è –∫—É–ª—ñ ‚Äî –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                        const sphereIntersect = raycaster.intersectObject(sphere);
                        if (sphereIntersect.length > 0 && !isRotating) {
                            isRotating = true;
                            setTimeout(() => { isRotating = false; }, 5000); // 5 —Å–µ–∫
                            showMessage('–ö—É–ª—è –æ–±–µ—Ä—Ç–∞—î—Ç—å—Å—è... –í–∏–±–µ—Ä–∏ –¥–µ–Ω—å!');
                        }
                    }
                });

                // –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –¥–Ω—è
                function openDay(plane, day) {
                    const clone = plane.clone();
                    clone.position.copy(plane.position);
                    clone.scale.copy(plane.scale);
                    scene.add(clone);

                    let fallTime = 0;
                    const duration = 1500;
                    const startY = clone.position.y;

                    const anim = () => {
                        fallTime += 16;
                        const progress = Math.min(fallTime / duration, 1);
                        const ease = 1 - Math.pow(1 - progress, 3);

                        clone.scale.setScalar(1 + ease * 2);
                        clone.position.y = startY - ease * 0.3;
                        clone.material.opacity = 1 - ease;

                        if (progress < 1) {
                            requestAnimationFrame(anim);
                        } else {
                            scene.remove(clone);
                            showMessage(`–î–µ–Ω—å ${day} –≤—ñ–¥–∫—Ä–∏—Ç–æ! "${adventTasks[day - 1]}" üéâ`, 4000);
                            plane.visible = false;
                        }
                    };
                    anim();
                }

                // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                function showMessage(text, timeout = 2000) {
                    const msg = document.getElementById('info');
                    msg.innerHTML = text;
                    setTimeout(() => { 
                        msg.innerHTML = `AR –ê–¥–≤–µ–Ω—Ç-–ö–∞–ª–µ–Ω–¥–∞—Ä üéÑ<br>–°—å–æ–≥–æ–¥–Ω—ñ: –î–µ–Ω—å <span id="today">${unlockedDays || '0 (—á–µ–∫–∞–π –≥—Ä—É–¥–Ω—è!)'}</span><br>–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä —ñ —Ç–æ—Ä–∫–Ω–∏—Å—è –∫—É–ª—ñ!`; 
                    }, timeout);
                }

                // –ó–∞–ø—É—Å–∫
                await mindarThree.start();
                renderer.setAnimationLoop(() => {
                    if (isRotating) {
                        textContainer.rotation.y += rotationSpeed;
                    }
                    renderer.render(scene, camera);
                });
            };
            start();
        });
    </script>
</body>
</html>
