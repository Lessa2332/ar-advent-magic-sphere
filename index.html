<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Magical Snow Globe AR</title>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        .container { width: 100%; height: 100vh; }
        #ar-container { width: 100%; height: 100%; }
        .loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 1000; 
            color: white; 
            background: rgba(0,0,0,0.7); 
            padding: 20px; 
            border-radius: 10px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞–≥—ñ—á–Ω–æ—ó –∫—É–ª—ñ... –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä</div>
    
    <div class="container">
        <div id="ar-container">
            <a-scene 
                mindar-image="imageTargetSrc: ./card.mind; autoStart: true;"
                color-space="sRGB"
                embedded 
                renderer="colorManagement: true, physicallyCorrectLights"
                vr-mode-ui="enabled: false"
                device-orientation-permission-ui="enabled: false">
                
                <a-camera active="true" position="0 0 0" look-controls="enabled: false"></a-camera>

                <a-entity mindar-image-target="targetIndex: 0">
                    <!-- –ó–æ–≤–Ω—ñ—à–Ω—è —Å–∫–ª—è–Ω–∞ –∫—É–ª—è -->
                    <a-sphere 
                        id="glass-sphere"
                        class="clickable"
                        radius="0.4"
                        position="0 0.5 0"
                        color="#e6f7ff"
                        opacity="0.3"
                        transparent="true"
                        shader="standard"
                        metalness="0.9"
                        roughness="0.05"
                        mindar-raycastable>
                    </a-sphere>

                    <!-- –°–Ω—ñ–≥ –í–°–ï–†–ï–î–ò–ù–Ü –∫—É–ª—ñ -->
                    <a-entity id="snow-container" position="0 0.5 0">
                        <a-entity id="snow-particles"></a-entity>
                    </a-entity>

                    <!-- –°–Ω—ñ–≥–æ–≤–∞ –æ—Å–Ω–æ–≤–∞ -->
                    <a-circle 
                        id="snow-base"
                        position="0 0.1 0"
                        radius="0.35"
                        color="#ffffff"
                        opacity="0.8"
                        rotation="-90 0 0">
                    </a-circle>

                    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∏–π –æ–±–æ–¥–æ–∫ -->
                    <a-torus 
                        id="glass-ring"
                        radius="0.4"
                        arc="360"
                        color="#88ccff"
                        opacity="0.6"
                        rotation="90 0 0"
                        transparent="true">
                    </a-torus>

                    <!-- –¢–µ–∫—Å—Ç–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç -->
                    <a-text 
                        id="text-display"
                        value="–ú–∞–≥—ñ—á–Ω–∏–π —Ç–µ–∫—Å—Ç 1"
                        position="0 1.0 0"
                        align="center"
                        color="#ffffff"
                        font="roboto"
                        width="3"
                        look-at="[camera]"
                        billboard="true"
                        opacity="0.9">
                    </a-text>
                </a-entity>
            </a-scene>
        </div>
    </div>

    <script>
        // –ß–µ–∫–∞—î–º–æ –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.addEventListener('DOMContentLoaded', function() {
            // –ú–∞—Å–∏–≤ –∑ 15 —Ç–µ–∫—Å—Ç–∞–º–∏
            const textOptions = [
                "üéØ –ü–µ—Ä—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç",
                "‚ú® –î—Ä—É–≥–∏–π —Ç–µ–∫—Å—Ç", 
                "üîÆ –ú–∞–≥—ñ—á–Ω–µ —Å–ª–æ–≤–æ",
                "üåü –ó–æ—Ä—è–Ω–µ –ø–æ—Å–ª–∞–Ω–Ω—è",
                "üí´ –û–±–µ—Ä—Ç–∞–ª—å–Ω–∞ —Å–∏–ª–∞",
                "‚ùÑÔ∏è –°–Ω—ñ–≥–æ–≤–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è",
                "üî• –í–æ–≥–Ω—è–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è",
                "üíß –í–æ–¥—è–Ω–∏–π –ø–æ—Ç—ñ–∫",
                "üå™Ô∏è –í—ñ—Ç—Ä—è–Ω–∞ –±—É—Ä—è", 
                "üåô –ú—ñ—Å—è—á–Ω–µ —Å–≤—ñ—Ç–ª–æ",
                "‚òÄÔ∏è –°–æ–Ω—è—á–Ω–∏–π –ø—Ä–æ–º—ñ–Ω—å",
                "‚ö° –ï–ª–µ–∫—Ç—Ä–∏—á–Ω–∞ —ñ—Å–∫—Ä–∞",
                "ü™Ñ –ß–∞—Ä—ñ–≤–Ω–∞ –ø–∞–ª–∏—á–∫–∞",
                "üîÆ –ö—Ä–∏—à—Ç–∞–ª–µ–≤–∞ –∫—É–ª—è",
                "üéÑ –ù–æ–≤–æ—Ä—ñ—á–Ω–µ –¥–∏–≤–æ"
            ];

            let currentRotation = 0;
            let isRotating = false;
            let currentTextIndex = 0;
            let snowParticles = [];
            let snowInterval;
            let effectsInterval;

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
            function createSnowParticles(count) {
                const snowContainer = document.querySelector('#snow-particles');
                if (!snowContainer) return;
                
                snowContainer.innerHTML = '';
                snowParticles = [];

                for (let i = 0; i < count; i++) {
                    const snowflake = document.createElement('a-sphere');
                    const size = 0.008 + Math.random() * 0.015;
                    const radius = Math.random() * 0.35;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    
                    const x = radius * Math.sin(phi) * Math.cos(theta);
                    const y = radius * Math.cos(phi);
                    const z = radius * Math.sin(phi) * Math.sin(theta);
                    
                    snowflake.setAttribute('radius', size);
                    snowflake.setAttribute('color', '#ffffff');
                    snowflake.setAttribute('opacity', 0.7 + Math.random() * 0.3);
                    snowflake.setAttribute('position', { x: x, y: y, z: z });
                    
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ dataset
                    snowflake.dataset.speed = (0.3 + Math.random() * 0.4).toString();
                    snowflake.dataset.originalY = y.toString();
                    snowflake.dataset.timeOffset = (Math.random() * Math.PI * 2).toString();
                    
                    snowContainer.appendChild(snowflake);
                    snowParticles.push(snowflake);
                }
            }

            // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–≥—É
            function animateSnow(intensity) {
                const currentTime = Date.now() * 0.001;
                
                snowParticles.forEach(function(snowflake) {
                    const speed = parseFloat(snowflake.dataset.speed) * intensity;
                    const originalY = parseFloat(snowflake.dataset.originalY);
                    const timeOffset = parseFloat(snowflake.dataset.timeOffset);
                    
                    const pos = snowflake.getAttribute('position');
                    let newY = originalY - (currentTime * 0.1 * speed);
                    
                    if (newY < -0.35) {
                        newY = 0.35;
                        snowflake.dataset.originalY = newY.toString();
                    }
                    
                    const swingX = Math.sin(currentTime * speed + timeOffset) * 0.05;
                    const swingZ = Math.cos(currentTime * speed * 0.7 + timeOffset) * 0.05;
                    
                    snowflake.setAttribute('position', {
                        x: pos.x + swingX * intensity,
                        y: newY,
                        z: pos.z + swingZ * intensity
                    });
                    
                    snowflake.setAttribute('rotation', {
                        x: currentTime * 50 * speed,
                        y: currentTime * 30 * speed,
                        z: currentTime * 40 * speed
                    });
                    
                    const flicker = 0.6 + Math.sin(currentTime * 5 + timeOffset) * 0.4;
                    snowflake.setAttribute('opacity', 0.5 * flicker);
                });
            }

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
            function init() {
                const scene = document.querySelector('a-scene');
                const loading = document.querySelector('#loading');

                if (!scene) {
                    console.error('A-Scene not found');
                    return;
                }

                // –ß–µ–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ü–µ–Ω–∏
                scene.addEventListener('loaded', function() {
                    console.log('AR —Å—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞');
                    
                    // –°—Ç–≤–æ—Ä—é—î–º–æ —Å–Ω—ñ–∂–∏–Ω–∫–∏
                    createSnowParticles(60);
                    
                    // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    setTimeout(function() {
                        if (loading) loading.style.display = 'none';
                    }, 3000);

                    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    startAnimations();
                });

                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É
                scene.addEventListener('click', function(event) {
                    if (isRotating) return;
                    
                    const intersectedEl = event.detail.intersectedEl;
                    if (intersectedEl && intersectedEl.id === 'glass-sphere') {
                        onSphereClick();
                    }
                });
            }

            function onSphereClick() {
                if (isRotating) return;
                
                isRotating = true;
                currentRotation += 360;
                
                const textDisplay = document.querySelector('#text-display');
                const snowContainer = document.querySelector('#snow-container');
                
                if (!textDisplay || !snowContainer) return;
                
                // –Ü–Ω—Ç–µ–Ω—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å–Ω—ñ–≥–æ–ø–∞–¥—É
                let snowIntensity = 3;
                const intensityInterval = setInterval(function() {
                    snowIntensity -= 0.1;
                    if (snowIntensity < 1) {
                        clearInterval(intensityInterval);
                    }
                }, 150);

                // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
                textDisplay.setAttribute('animation', {
                    property: 'rotation',
                    to: '0 ' + currentRotation + ' 0',
                    dur: 1000,
                    easing: 'easeOutCubic'
                });

                // –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è —Å–Ω—ñ–≥–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏
                snowContainer.setAttribute('animation', {
                    property: 'rotation',
                    to: '0 ' + (currentRotation * 0.5) + ' 0',
                    dur: 1200,
                    easing: 'easeOutQuad'
                });

                // –ó–º—ñ–Ω–∞ —Ç–µ–∫—Å—Ç—É –ø—ñ—Å–ª—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                setTimeout(function() {
                    let newIndex;
                    do {
                        newIndex = Math.floor(Math.random() * textOptions.length);
                    } while (newIndex === currentTextIndex && textOptions.length > 1);
                    
                    currentTextIndex = newIndex;
                    textDisplay.setAttribute('value', textOptions[newIndex]);
                    isRotating = false;
                }, 1000);
            }

            function startAnimations() {
                // –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏, —è–∫—â–æ –≤–æ–Ω–∏ —î
                if (snowInterval) clearInterval(snowInterval);
                if (effectsInterval) clearInterval(effectsInterval);
                
                // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–≥—É
                snowInterval = setInterval(function() {
                    const baseIntensity = isRotating ? 2.5 : 1;
                    animateSnow(baseIntensity);
                }, 50);

                // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏
                effectsInterval = setInterval(function() {
                    const sphere = document.querySelector('#glass-sphere');
                    const glassRing = document.querySelector('#glass-ring');
                    
                    if (sphere) {
                        const glow = 0.2 + Math.sin(Date.now() * 0.002) * 0.1;
                        sphere.setAttribute('opacity', (0.25 + glow).toString());
                    }
                    
                    if (glassRing) {
                        const rotation = glassRing.getAttribute('rotation');
                        glassRing.setAttribute('rotation', {
                            x: rotation.x,
                            y: rotation.y + 0.3,
                            z: rotation.z
                        });
                    }
                }, 100);
            }

            // –ó–∞–ø—É—Å–∫–∞—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é
            init();
        });
    </script>
</body>
</html>
